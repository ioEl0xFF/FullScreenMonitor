# FullScreenMonitor 動作フロー図

## 1. アプリケーション起動フロー

```
[アプリケーション起動]
         ↓
[ロガー初期化]
         ↓
[多重起動チェック (Mutex)]
         ↓
[例外ハンドラー設定]
         ↓
[MainWindow作成・非表示]
         ↓
[設定読み込み (JSON)]
         ↓
[システムトレイアイコン初期化]
         ↓
[監視サービス初期化]
         ↓
[監視開始]
```

## 2. 全画面監視フロー

```
[タイマー起動 (500ms間隔)]
         ↓
[全ウィンドウ列挙 (EnumWindows)]
         ↓
[各ウィンドウをチェック]
         ↓
┌─────────────────────────────────┐
│ 1. 可視性チェック                │
│ 2. システムウィンドウ除外        │
│ 3. プロセス名マッチング          │
│ 4. 最大化状態チェック            │
│ 5. 作業領域完全覆いチェック      │
└─────────────────────────────────┘
         ↓
[全画面状態変更検出]
         ↓
[イベント発火]
```

## 3. ウィンドウ最小化・復元フロー

### 全画面検出時

```
[全画面状態検出]
         ↓
[同一モニター上のウィンドウ取得]
         ↓
[除外条件チェック]
         ↓
┌─────────────────────────────────┐
│ - 全画面ウィンドウ除外           │
│ - システムウィンドウ除外         │
│ - 既に最小化済み除外             │
│ - 別モニター除外                 │
└─────────────────────────────────┘
         ↓
[ウィンドウ最小化実行]
         ↓
[最小化履歴に記録]
         ↓
[バルーンチップ表示]
```

### 全画面解除時

```
[全画面解除検出]
         ↓
[最小化履歴から復元]
         ↓
[ウィンドウ復元実行]
         ↓
[履歴クリア]
         ↓
[バルーンチップ表示]
```

## 4. システムトレイ操作フロー

```
[システムトレイアイコン]
         ↓
┌─────────────────────────────────┐
│ ダブルクリック → 設定画面表示     │
│ 右クリック → コンテキストメニュー │
│ マウス移動 → ツールチップ更新     │
└─────────────────────────────────┘
         ↓
[設定画面]
         ↓
┌─────────────────────────────────┐
│ - 監視対象プロセス追加・削除     │
│ - 監視間隔設定                   │
│ - スタートアップ登録設定         │
│ - 実行中プロセス一覧表示         │
└─────────────────────────────────┘
         ↓
[設定保存 (JSON)]
         ↓
[監視サービス再起動]
```

## 5. エラーハンドリングフロー

```
[例外発生]
         ↓
[ログ出力]
         ↓
┌─────────────────────────────────┐
│ UIスレッド例外 → MessageBox表示  │
│ アプリドメイン例外 → ログ記録    │
│ 監視エラー → バルーンチップ表示  │
└─────────────────────────────────┘
         ↓
[アプリケーション継続]
```

## 6. アプリケーション終了フロー

```
[終了要求]
         ↓
[監視サービス停止]
         ↓
[最小化ウィンドウ復元]
         ↓
[システムトレイアイコン非表示]
         ↓
[リソース解放]
         ↓
[アプリケーション終了]
```
